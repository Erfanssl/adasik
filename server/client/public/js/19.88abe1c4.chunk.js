(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{478:function(e,t,n){"use strict";var r=n(118),a=n.n(r);var s=function(){var e=navigator.userAgent;return e.match(/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i)?"tablet":e.match(/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/)?"mobile":"desktop"};var c=function(e){var t=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),n=function(){},r={},a=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g;function s(t){r[t]||e(t),r[t]=!0}t.createDataChannel(""),t.createOffer().then((function(e){e.sdp.split("\n").forEach((function(e){e.indexOf("candidate")<0||e.match(a).forEach(s)})),t.setLocalDescription(e,n,n)})).catch((function(e){})),t.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(a)&&e.candidate.candidate.match(a).forEach(s)}};t.a=function(){var e=a.a.connect("/pageview",{transports:["websocket"],upgrade:!1});return e.on("connect",(function(){})),e.on("visitorConnected",(function(){var t={pageviewUrl:window.location.pathname,httpReferer:document.referrer,deviceType:s()};c((function(n){t.ip||(t.ip=n,fetch("/api/pageview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(t){e.emit("viewData",t.data)})))}))})),e}},479:function(e,t,n){"use strict";var r=n(0),a=n.n(r),s=n(65),c=n(10),i=n(156);function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(n){var r=n.identifier,s=o(n,["identifier"]);return r?r.NotAuthorizedError?(i.a.push("/sign-in"),a.a.createElement("div",null,"Redirecting...")):r.FetchError?a.a.createElement(c.a,{text:"Unable to fetch data. Try again"}):r.name||t?r.text||!r.name&&t?a.a.createElement(e,s):a.a.createElement(c.a,null):(i.a.push("/settings/profile"),a.a.createElement("div",null,"Redirecting...")):a.a.createElement(c.a,null)}function r(e){return{identifier:e.identifier}}return Object(s.b)(r,null)(a.a.memo(n))}},480:function(e,t,n){"use strict";var r=n(0),a=n.n(r);t.a=function(){return a.a.createElement("div",{className:"spinner"})}},482:function(e,t,n){"use strict";t.a=n.p+"images/close.d8923f7e5736295380118610b2df9608.svg"},486:function(e,t,n){"use strict";t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return(null==e?void 0:e.length)>=t?e.substr(0,t-3)+"...":e}},513:function(e,t,n){"use strict";t.a=function(e){var t=new Date-new Date(e);if(t<=3e4)return"just now";if(t<=6e4)return"moment ago";if(t<=12e4)return"a minute ago";if(t<36e5)return"".concat((t/6e4).toFixed(0)," minutes ago");if(36e5===t)return"1 hour ago";var n=(t/36e5).toFixed(0);return t<=864e5?"".concat(n," hour").concat("1"===n?"":"s"," ago"):t<=1728e5?"yesterday":new Date(e).toDateString().split(" ").slice(-3).join(" ")}},514:function(e,t,n){"use strict";t.a=n.p+"images/back.c7efca872ccf308ce01101740d02e731.svg"},534:function(e,t,n){"use strict";t.a=n.p+"images/check.73235d2764aad8c391dc7e63aff8a6e0.svg"},536:function(e,t,n){"use strict";t.a=n.p+"images/close-reply.ccd5a6e377936aba42f24666050eb078.svg"},739:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(731),c=n.n(s),i=n(65),o=n(66),l=n(118),u=n.n(l),m=n(44),d=n(148),f=n(39);function g(e,t,n){if(n)return t?t(e()):e();try{var r=Promise.resolve(e());return t?r.then(t):r}catch(e){return Promise.reject(e)}}function p(e,t){var n=e();return n&&n.then?n.then(t):t(n)}function v(e,t){if(!t)return e&&e.then?e.then(j):Promise.resolve()}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function O(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function j(){}function S(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}function N(e){if(e&&e.then)return e.then(j)}var w=n(119);function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,s=void 0;try{for(var c,i=e[Symbol.iterator]();!(r=(c=i.next()).done)&&(n.push(c.value),!t||n.length!==t);r=!0);}catch(e){a=!0,s=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw s}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var I=function(e){var t,n=e.shouldMessageSent,s=e.messageInputChange,c=e.onMessengerInputEl,i=e.onHandleMessageSent,o=e.onShowMic,l=e.messengerSocket,u=e.fromUsername,m=e.toUsername,d=e.fullName,f=e.shouldClear,g=_(Object(r.useState)(""),2),p=g[0],v=g[1],y=_(Object(r.useState)(!1),2),h=y[0],b=y[1],E=_(Object(r.useState)(null),2),O=E[0],j=E[1],S=_(Object(r.useState)(!0),2),N=S[0],w=S[1],C=_(Object(r.useState)({}),2),I=C[0],k=C[1],M=Object(r.useRef)(),T=Object(r.useRef)(!1),A=Object(r.useRef)(!1),R=Object(r.useRef)(!1),D=Object(r.useRef)(!1),U=Object(r.useRef)(0),F=Object(r.useRef)(0);return Object(r.useEffect)((function(){M.current&&c(M)}),[M]),Object(r.useEffect)((function(){n&&(i(p),v(""),null!=M&&M.current&&M.current.focus())}),[n]),Object(r.useEffect)((function(){if(null!=s&&s.emoji){if(void 0!==p&&!p.trim().length)return U.current=2,v(s.emoji);var e=document.getSelection().getRangeAt(0),t=e.cloneRange();t.selectNodeContents(M.current),t.setEnd(e.endContainer,e.endOffset);var n=t.toString().length;M.current.firstChild.insertData(n,s.emoji);var r=M.current.textContent;return U.current=n+2,v(r)}v(s)}),[s]),Object(r.useEffect)((function(){if(p.trim().length?o(!1):o(!0),void 0!==p){O&&(clearTimeout(O),j(null)),N&&(l.emit("typing",{fromUsername:u,toUsername:m,isTyping:!0,fullName:d}),w(!1));var e=setTimeout((function(){b(!0)}),2e3);if(j(e),p&&p.length<=2)if(p[0].charCodeAt(0)>=1570&&p[0].charCodeAt(0)<=1740){var t={direction:"rtl",fontFamily:"Tahoma",fontSize:"1.47rem"};k(t)}else k({})}}),[p]),Object(r.useLayoutEffect)((function(){var e,t,n;p&&((e=document.createRange()).setStart(M.current.firstChild,U.current),e.setEnd(M.current.firstChild,U.current),(t=window.getSelection()).removeAllRanges(),t.addRange(e),null!=F&&F.current&&(null===(n=M.current)||void 0===n||n.scrollTo(0,F.current)))}),[p]),Object(r.useEffect)((function(){h&&(l.emit("typing",{fromUsername:u,toUsername:m,isTyping:!1,fullName:d}),clearTimeout(O),j(null),w(!0),b(!1))}),[h]),Object(r.useEffect)((function(){f&&f.length&&(f[0]&&v(""),null!=M&&M.current&&window.innerWidth>600&&M.current.focus())}),[f]),a.a.createElement("div",{className:"input__message--container"},a.a.createElement("div",{className:"editable-input__container",onFocus:function(e){return e.target.parentNode.style.border=".1rem solid rgba(0, 255, 0, .6)"},onBlur:function(e){return e.target.parentNode.style.border=".1rem solid rgba(255, 255, 255, .3)"}},a.a.createElement("div",{contentEditable:!0,className:"editable-input",spellCheck:!0,onKeyDown:function(e){return 13===e.keyCode&&!1===R.current&&(R.current=!0),16===e.keyCode&&!1===T.current&&(T.current=!0),17===e.keyCode&&!1===A.current&&(A.current=!0),32===e.keyCode&&!1===D.current&&(D.current=!0),D.current&&!p.trim().length?e.preventDefault():R.current&&p.trim().length&&!T.current&&!A.current?(i(p),v(""),e.preventDefault(),b(!0)):R.current&&!p.trim().length?e.preventDefault():void 0},onKeyUp:function(e){13===e.keyCode&&(R.current=!1),16===e.keyCode&&(T.current=!1),17===e.keyCode&&(A.current=!1),32===e.keyCode&&(D.current=!1)},onInput:function(e){var t,n;if(!e.target.textContent.trim().length)return v("");var r=document.getSelection().getRangeAt(0),a=r.cloneRange();a.selectNodeContents(M.current),a.setEnd(r.endContainer,r.endOffset);var s=a.toString().length,c=M.current.firstChild.length;U.current=s,F.current=s===c||s===c+1?null===(t=M.current)||void 0===t?void 0:t.scrollHeight:null===(n=M.current)||void 0===n?void 0:n.scrollTop;var i=e.target.textContent.split("");"\n"!==i[i.length-1]&&v(e.target.textContent)},ref:M,style:I},p),a.a.createElement("div",{className:(t="placeholder",p&&(t+=" hide"),t)},window.innerWidth>370?"Write your message...":"Your message...")))},k=a.a.memo(I),M=n(480),T=n.p+"images/play-audio.8198997f57842ad59c5263bd9526c4cc.svg",A=n.p+"images/pause-audio.a1ad02674fe5ed3db420685f79e34e6d.svg";function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,s=void 0;try{for(var c,i=e[Symbol.iterator]();!(r=(c=i.next()).done)&&(n.push(c.value),!t||n.length!==t);r=!0);}catch(e){a=!0,s=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw s}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var U=function(e){var t=e.source,n=e.shouldStop,s=R(Object(r.useState)(!1),2),c=s[0],i=s[1],o=R(Object(r.useState)(0),2),l=o[0],u=o[1],m=R(Object(r.useState)(0),2),d=m[0],f=m[1],g=R(Object(r.useState)(null),2),p=g[0],v=g[1],y=R(Object(r.useState)(!1),2),h=y[0],b=y[1],E=R(Object(r.useState)(!1),2),O=E[0],j=E[1],S=R(Object(r.useState)(!1),2),N=S[0],w=S[1],_=R(Object(r.useState)(-2),2),C=_[0],I=_[1],k=R(Object(r.useState)(!1),2),D=k[0],U=k[1];Object(r.useEffect)((function(){if(t){var e=document.createElement("audio");e.preload="auto",e.src=t,e.oncanplaythrough=function(){b(!0),v(e),f(e.duration)}}}),[]),Object(r.useEffect)((function(){n&&n.length&&n[0]&&p&&p.pause()}),[n]),Object(r.useEffect)((function(){var e;if(!h&&t){var n=new Audio;n.oncanplaythrough=function(){b(!0),f(n.duration),v(n)},e=setInterval((function(){n.src=t}),1e3)}return function(){clearInterval(e)}}),[h]);var F=Object(r.useRef)();function P(e){var t=("00"+Math.floor(e/60).toString()).substr(-2),n=("00"+(e%60).toString()).substr(-2);return"".concat(t,":").concat(n)}return Object(r.useEffect)((function(){var e;if(O){e=requestAnimationFrame((function t(){u(Number(p.currentTime)),p.currentTime>=p.duration?(i(!0),j(!1)):e=requestAnimationFrame(t)}))}return function(){cancelAnimationFrame(e)}}),[O]),Object(r.useEffect)((function(){}),[c]),Object(r.useEffect)((function(){N&&(j(!1),p.pause())}),[N]),Object(r.useEffect)((function(){if(N&&!O){var e;null!=F&&F.current&&(e=F.current.offsetWidth);var t=C/e*d;p.currentTime=Number(t),u(Number(t))}}),[N,O,C]),Object(r.useEffect)((function(){D&&(p.play(),j(!0))}),[D]),a.a.createElement("div",{className:"messenger--audio-player__container"},h?a.a.createElement("div",{className:"messenger--audio-player__ready"},a.a.createElement("div",{style:{display:"flex",width:"100%",alignItems:"center"}},a.a.createElement("div",{className:"audio--buttons"},O?a.a.createElement("div",{className:"pause--btn",onClick:function(){p&&p.pause(),j(!1)}},a.a.createElement("img",{src:A,alt:"pause"})):a.a.createElement("div",{className:"play--btn",onClick:function(){p&&!O&&(p.play(),j(!0))}},a.a.createElement("img",{src:T,alt:"play"}))),a.a.createElement("div",{className:"progress-bar--container",onMouseDown:function(){w(!0),U(!1)},onMouseMove:function(e){var t=e.clientX-F.current.getClientRects()[0].x;I(t)},onMouseUp:function(){w(!1),U(!0)},ref:F},a.a.createElement("div",{className:"progress-bar--bg",style:{width:"".concat(l/d*100,"%")}}),a.a.createElement("div",{className:"progress-bar--btn",style:{left:"".concat(l/d*100,"%")}}))),a.a.createElement("div",{className:"time--container"},a.a.createElement("p",null,P(l.toFixed(0))," / ",P(d.toFixed(0))))):a.a.createElement("div",{className:"messenger--audio-player__not-ready"},a.a.createElement(M.a,null)))},F=a.a.memo(U),P=n(10),x=n(486),L=n(479),B=n(513);var H=function(e){var t=new Date-new Date(e);return t<=864e5?"TODAY":t<=1728e5?"YESTERDAY":e.split(" ").slice(-3).join(" ")},W=n(478),Y=n(74),z=n.p+"images/send.4944a50dfaa15c0cd6ecdb6e717be18b.svg",J=n(534),q=n.p+"images/happy.6085101d4aa10112244fd62472611c1c.svg",K=n.p+"images/microphone.22a1499d7f2e69c0fb589f9f7d7d86c8.svg",$=n.p+"images/right-arrow.8b8fb639d7ed68731e5b073c0700d3bf.svg",X=n.p+"images/writing.ff5342ef44d7dfd4a795de43df4c42d8.svg",G=n(536),Q=n.p+"images/pending.e0d2eab935eba947245cc834bf702a0c.svg",V=n.p+"images/stop.b992165a696747acb233d407dff88e08.svg",Z=n(482),ee=n(514);function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||ce(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,s=void 0;try{for(var c,i=e[Symbol.iterator]();!(r=(c=i.next()).done)&&(n.push(c.value),!t||n.length!==t);r=!0);}catch(e){a=!0,s=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw s}}return n}(e,t)||ce(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var oe=function(e){var t=e.userId,n=e.userInfo,s=e.identifier,i=e.fetchMessages,l=e.fetchIndividualConversation,m=e.updateMessageStatus,d=e.submitNewMessage,f=e.fetchMessengerSocket,g=e.submitNewMessageFromSocket,p=e.updateMessageText,v=e.updateMessageTextFromSocket,y=e.deleteMessageForMe,h=e.deleteMessageForEveryone,b=e.deleteMessageFromSocket,E=e.wipeTempMessage,O=e.wipeIndividualConversation,j=e.receiveNotificationMessenger,S=e.messengerUpdateUserStatus,N=e.messengerStart,w=e.conversations,_=e.conversationData,C=e.statusSocket,I=se(Object(r.useState)(""),2),T=I[0],A=I[1],R=se(Object(r.useState)(!1),2),D=R[0],U=R[1],L=se(Object(r.useState)(!1),2),Y=L[0],te=L[1],re=se(Object(r.useState)(""),2),ie=re[0],oe=re[1],le=se(Object(r.useState)(-1),2),ue=le[0],me=le[1],de=se(Object(r.useState)(-1),2),fe=de[0],ge=de[1],pe=se(Object(r.useState)(""),2),ve=pe[0],ye=pe[1],he=se(Object(r.useState)(""),2),be=he[0],Ee=he[1],Oe=se(Object(r.useState)("regular"),2),je=Oe[0],Se=Oe[1],Ne=se(Object(r.useState)({}),2),we=Ne[0],_e=Ne[1],Ce=se(Object(r.useState)({}),2),Ie=Ce[0],ke=Ce[1],Me=se(Object(r.useState)(!1),2),Te=Me[0],Ae=Me[1],Re=se(Object(r.useState)({}),2),De=Re[0],Ue=Re[1],Fe=se(Object(r.useState)({}),2),Pe=Fe[0],xe=Fe[1],Le=se(Object(r.useState)(!1),2),Be=Le[0],He=Le[1],We=se(Object(r.useState)(""),2),Ye=We[0],ze=We[1],Je=se(Object(r.useState)(""),2),qe=Je[0],Ke=Je[1],$e=se(Object(r.useState)(!0),2),Xe=$e[0],Ge=$e[1],Qe=se(Object(r.useState)(!1),2),Ve=Qe[0],Ze=Qe[1],et=se(Object(r.useState)({}),2),tt=et[0],nt=et[1],rt=se(Object(r.useState)(null),2),at=rt[0],st=rt[1],ct=se(Object(r.useState)(null),2),it=ct[0],ot=ct[1],lt=se(Object(r.useState)(null),2),ut=lt[0],mt=lt[1],dt=se(Object(r.useState)({minutes:0,seconds:0}),2),ft=dt[0],gt=dt[1],pt=se(Object(r.useState)(""),2),vt=pt[0],yt=pt[1],ht=se(Object(r.useState)({mediaRecorder:null,chunks:[]}),2),bt=ht[0],Et=ht[1],Ot=se(Object(r.useState)(!1),2),jt=Ot[0],St=Ot[1],Nt=se(Object(r.useState)(!1),2),wt=(Nt[0],Nt[1]),_t=se(Object(r.useState)({}),2),Ct=_t[0],It=_t[1],kt=se(Object(r.useState)({changed:!1,type:"",data:null}),2),Mt=kt[0],Tt=kt[1],At=se(Object(r.useState)([]),2),Rt=At[0],Dt=At[1],Ut=se(Object(r.useState)([]),2),Ft=Ut[0],Pt=Ut[1],xt=se(Object(r.useState)([!1]),2),Lt=xt[0],Bt=xt[1],Ht=se(Object(r.useState)(!1),2),Wt=(Ht[0],Ht[1]),Yt=se(Object(r.useState)(!1),2),zt=Yt[0],Jt=Yt[1],qt=se(Object(r.useState)(0),2),Kt=qt[0],$t=qt[1],Xt=Object(r.useRef)(),Gt=Object(r.useRef)(),Qt=Object(r.useRef)(),Vt=Object(r.useRef)(),Zt=Object(r.useRef)(),en=Object(r.useRef)(),tn=Object(r.useRef)(),nn=Object(r.useRef)(),rn=Object(r.useRef)(),an=Object(r.useRef)(),sn=Object(r.useRef)(!1),cn=Object(r.useRef)(!1),on=Object(r.useRef)(!1);function ln(e,t){null!=qe&&qe.current&&ze({emoji:t.emoji})}function un(){U((function(e){return!e})),qe.current.focus()}function mn(e){if(0!==e.trim().length){var r={message:e,type:"regular",from:t,to:ve,createdAt:(new Date).toISOString()};"reply"===je&&(r.reply=we.id,r.tempReply=we.toMessageId,r.type="reply"),"update"===je||"replyUpdate"===je?p(e,ve,Ie.id,Ie.isLast,je,T,r,Ie.toMessageId):d(r,ve,T,C,!1,n).then(ge.bind(null,0)),on.current=!0,He(!1),Se("regular"),_e({}),ke({}),Ze(!1)}}function dn(e,t,n,r,a,s,c){_&&_.userId===t||(l(e,n,r,!0,void 0,s),Jt(!0),cn.current=!1,c&&j("decrement"),_&&_.userId!==t&&(Bt([!0]),ot(!1)),It({conversationId:e,fullName:n,messengerStatus:r,username:s}),oe(""),me(-1),ge(a),ye(t),Ee(n),$t(0),rn&&rn.current&&window.innerWidth<=1300&&(rn.current.style.display="none"),nn&&nn.current&&window.innerWidth<=1300&&(nn.current.style.display="flex"))}function fn(e){if(null!=Xt&&Xt.current){var t=Xt.current;t.scrollTo(0,t.scrollHeight)}}function gn(e){var t=document.querySelector('[data-id="'.concat(e,'"]'));Xt.current.scrollTo(0,t.offsetTop-3*t.offsetHeight)}function pn(e,t){gn(e),oe(e)}function vn(e){var t=e.target;t.className||(t=t.parentElement),me(parseInt(t.dataset.show))}function yn(e,t,n,r,a){_e({message:e,side:t,id:n,isBuf:r,toMessageId:a}),ke({}),Se("reply"),null==qe||qe.current.focus()}function hn(e,t,n,r,a,s){ke({message:e,side:t,id:n,isLast:a,toMessageId:s}),_e({}),"reply"===r?Se("replyUpdate"):"regular"===r||"update"===r?Se("update"):"replyUpdate"===r&&Se("replyUpdate"),ze(e)}function bn(e,t,n){Ue({show:!0,popUpTop:Xt.current.scrollTop+Xt.current.offsetHeight/3,mainBgTop:Xt.current.scrollTop,type:"forMe"}),xe({id:e,personId:t,isLast:n})}function En(e,t,n,r){Ue({show:!0,popUpTop:Xt.current.scrollTop+Xt.current.offsetHeight/3,mainBgTop:Xt.current.scrollTop,type:"forEveryone"}),xe(ne({id:e,personId:t,isLast:r},n))}function On(){function e(e,t,n){var r="messenger--message__tools-container";return n&&ue===e&&"deleteForMe"!==t&&1!==e?r+=" show-end":ue===e&&"deleteForMe"!==t&&(r+=" show"),r}var t={};_.messages.length&&_.messages.forEach((function(e){var n=new Date(e.createdAt).toDateString();t[n]=t[n]?[].concat(ae(t[n]),[e]):[e]}));var n=[];for(var r in t)n.push.apply(n,[{date:r}].concat(ae(t[r])));return n.map((function(t,r){var s=t.side,c=t.message,i=t.createdAt,o=t.status,l=t._id,u=t.type,m=t.reply,d=(t.to,t.isBuf),f=t.date,g=t.from,p=t.toMessageId;if(!s)return a.a.createElement("div",{key:f,className:"messenger--main__body-date-container",style:De.show||Ve||zt?{filter:"blur(.3rem)"}:{}},a.a.createElement("p",null,H(f)));var v=n.length-1===r;if("deleteForMe"!==u){var y,h,b,E={};return(De.show||Ve||zt)&&(E.filter="blur(.3rem)"),n[r+1]&&n[r+1].side!==s&&(E.marginBottom="1.5rem"),a.a.createElement("div",{key:l,"data-id":l,className:"host"===s?"messenger--main__body-host-container":"messenger--main__body-guest-container",style:E},a.a.createElement("div",{className:ie===l?"messenger--message__selected-reply":void 0}),a.a.createElement("div",{"data-show":r,onClick:vn,className:"messenger--message__tools-icon-container"},a.a.createElement("div",null),a.a.createElement("div",null),a.a.createElement("div",null)),"pending"!==o&&a.a.createElement("div",{className:e(r,u,v)},a.a.createElement("ul",null,"deleteForEveryone"!==u&&a.a.createElement("li",{onClick:yn.bind(null,c,s,l,d,p)},"Reply"),"host"===s&&"deleteForEveryone"!==u&&!d&&a.a.createElement("li",{onClick:hn.bind(null,c,s,l,u,v,p)},"Edit"),a.a.createElement("li",{onClick:bn.bind(null,l,ve,v)},"Delete for me"),"host"===s&&"deleteForEveryone"!==u&&a.a.createElement("li",{onClick:En.bind(null,l,ve,{from:g,toMessageId:p},v)},"Delete for everyone"))),("reply"===u||"replyUpdate"===u)&&function(e){var t=_.messages.find((function(t){return t._id===e})),n=null==t?void 0:t.message,r=null==t?void 0:t.side;if(t&&t.isBuf)return a.a.createElement("div",{className:"messenger--message__reply-container",onClick:pn.bind(null,e)},a.a.createElement("p",{className:"reply--name"},"host"===r?"You":_.fullName),a.a.createElement("div",{className:"messenger--item__voice-container"},a.a.createElement("img",{src:K,alt:"microphone"}),a.a.createElement("p",{className:"messenger--item__message"},"voice message")));var s={};return n&&n.charCodeAt(0)>=1570&&n.charCodeAt(0)<=1740&&(s.direction="rtl",s.fontFamily="Tahoma",s.fontSize="1.3rem"),a.a.createElement("div",{className:"messenger--message__reply-container",onClick:pn.bind(null,e)},a.a.createElement("p",{className:"reply--name"},"host"===r?"You":_.fullName),a.a.createElement("p",{style:s},Object(x.a)(n)))}(m),"deleteForEveryone"===u&&"host"===s&&a.a.createElement("em",{className:"delete"},"You deleted this message"),"deleteForEveryone"===u&&"guest"===s&&a.a.createElement("em",{className:"delete"},be," deleted this message"),"deleteForMe"!==u&&"deleteForEveryone"!==u&&!d&&a.a.createElement("p",{style:function(){var e={};return!c.isBuf&&2===c.length&&c.charCodeAt(0)>=55e3&&(e.fontSize="6rem",e.textAlign="center"),!c.isBuf&&c[0].charCodeAt(0)>=1570&&c[0].charCodeAt(0)<=1740&&(e.direction="rtl",e.fontFamily="Tahoma",e.fontSize="1.47rem"),e}()},c),"deleteForMe"!==u&&"deleteForEveryone"!==u&&d&&a.a.createElement(F,{source:c?"/api/messenger/v/v1/"+c:null,shouldStop:Lt}),("update"===u||"replyUpdate"===u)&&a.a.createElement("em",null,"edited"),a.a.createElement("div",{className:"messenger--main__body-meta-container"},a.a.createElement("span",null,(y=new Date(i).toLocaleTimeString(),h=y.split(" "),(b=h[0].split(":")).pop(),[b.join(":"),h[1]].join(" "))),"host"===s&&function(e){switch(e){case"pending":return a.a.createElement("div",{className:"messenger--message__pending"},a.a.createElement("img",{src:Q,alt:"pending"}));case"sent":return a.a.createElement("div",{className:"messenger--message__sent"},a.a.createElement("img",{src:J.a,alt:"check"}));case"delivered":return a.a.createElement("div",{className:"messenger--message__delivered"},a.a.createElement("img",{src:J.a,alt:"check"}),a.a.createElement("img",{src:J.a,alt:"check"}));case"seen":return a.a.createElement("div",{className:"messenger--message__seen"},a.a.createElement("img",{src:J.a,alt:"check"}),a.a.createElement("img",{src:J.a,alt:"check"}))}}(o)))}}))}function jn(){_e({}),Se("regular")}function Sn(){ke({}),Se("regular"),ze("")}function Nn(){oe(we.id),gn(we.id)}function wn(){oe(Ie.id),gn(Ie.id)}Object(r.useEffect)((function(){document.title="Adasik - Messenger",i().then((function(){te(!0)}));var e=Object(W.a)(),t=setInterval((function(){wt((function(e){return!e}))}),6e4),n=u.a.connect("/messenger");A(n),f(n),n.on("userOnline",(function(e){S(e,"online")})),n.on("userOffline",(function(e){S(e,"offline"),Dt((function(t){return t.filter((function(t){return t.username!==e}))})),Pt((function(t){return t.filter((function(t){return t.username!==e}))}))})),n.on("typing",(function(e){var t=e.fromUsername,n=e.isTyping,r=e.fullName;Dt((function(e){return e.length&&e.find((function(e){return e.username===t}))?e.map((function(e){return e.username===t?{username:t,isTyping:n,fullName:r}:e})):[].concat(ae(e),[{username:t,isTyping:n,fullName:r}])}))})),n.on("recording",(function(e){var t=e.fromUsername,n=e.isRecording,r=e.fullName;Pt((function(e){return e.length&&e.find((function(e){return e.username===t}))?e.map((function(e){return e.username===t?{username:t,isRecording:n,fullName:r}:e})):[].concat(ae(e),[{username:t,isRecording:n,fullName:r}])}))})),n.on("messageReceive",(function(e){if(e){var t=e.message,n=e.fromUsername,r=e.userInfo;t.side="guest",t.isBuf&&(t.message=t.messageBuf.receiverMessage),Tt({changed:!0,type:"messageReceive",data:{message:t,fromUsername:n,userInfo:r}})}})),n.on("messageUpdatedReceive",(function(e){if(e){var t=e.message,n=e.isLast;Tt({changed:!0,type:"messageUpdatedReceive",data:{message:t,isLast:n}})}})),n.on("messageDeletedReceive",(function(e){if(e){var t=e.message,n=e.isLast;Tt({changed:!0,type:"messageDeletedReceive",data:{message:t,isLast:n}})}})),n.on("messageDeliveredStatus",(function(e){var t=e.messageId,n=e.personId,r=e.status;m(t,r,n)})),n.on("messageSeenServer",(function(e){var t=e.personId,n=e.messageId;m(n,"seen",t)})),N();try{var r=r||webkitSpeechRecognition;if(void 0!==r){var a=new r;a.continuous=!0,a.interimResults=!0,a.addEventListener("result",(function(e){var t,n="",r=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=ce(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,c=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,s=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw s}}}}(e.results);try{for(r.s();!(t=r.n()).done;){var a=t.value;ze(a[0].transcript),n+=" "+a[0].transcript}}catch(e){r.e(e)}finally{r.f()}ze(n)})),a.addEventListener("end",(function(){Ze(!1)})),nt(a)}}catch(e){}return function(){n.disconnect(),e.disconnect(),l(null,null,null,null,!0,null),clearInterval(t),E()}}),[]),Object(r.useEffect)((function(){T&&s&&Object.keys(s).length&&T.emit("data",s)}),[T,s]),Object(r.useEffect)((function(){if(Mt.changed){if("messageReceive"===Mt.type){var e,t=Mt.data,n=t.message,r=t.fromUsername,a=t.userInfo;g(n,n.from,ve===n.from,a),(_&&_.username.toLowerCase()===r.toLowerCase()&&(null==Xt?void 0:Xt.current)&&Xt.current.scrollTop+Xt.current.offsetHeight)<(null==Xt||null===(e=Xt.current)||void 0===e?void 0:e.scrollHeight)-100&&$t((function(e){return e+1})),T.emit("messageReceiveStatus",{fromUsername:r,message:n,status:"delivered"}),ve===n.from&&T.emit("messageSeenClient",{username:r,personId:n.to,messageId:n._id}),Tt({changed:!1,type:"",data:null})}if("messageUpdatedReceive"===Mt.type){var s=Mt.data,c=s.message,i=s.isLast;c&&v(c.message,c.from,c.toMessageId,i,c.type,ve===c.from),Tt({changed:!1,type:"",data:null})}if("messageDeletedReceive"===Mt.type){var o=Mt.data,l=o.message,u=o.isLast;b(l.from,l.toMessageId,u,ve===l.from),Tt({changed:!1,type:"",data:null})}}}),[ve,Mt]),Object(r.useEffect)((function(){if(_&&_.isFromProfile){rn&&rn.current&&window.innerWidth<=1300&&(rn.current.style.display="none"),nn&&nn.current&&window.innerWidth<=1300&&(nn.current.style.display="flex");var e=w.sort((function(e,t){return new Date(t.messages[0].createdAt)-new Date(e.messages[0].createdAt)})).findIndex((function(e){return e.userId.toString()===_.userId.toString()})),t=w.find((function(e){return e.userId===_.userId}));t?dn(t._id,_.userId,_.fullName,_.messengerStatus,e,t.username):ye(_.userId)}_&&_.shouldConversationReload&&i(),_&&Jt(!1)}),[_,w]),Object(r.useEffect)((function(){var e={circle1:Gt,circle2:Qt,circle3:Vt,circle4:Zt,circle5:en};if(Ve&&tt.start){tt.start();var t=5,n=setInterval((function(){Object.values(e).forEach((function(e){return e.current.classList.remove("show-bg")}));var n="circle"+t;e[n]&&e[n].current.classList.add("show-bg"),t<=0&&(t=6),t--}),250);st(n)}else!Ve&&tt.stop&&(tt.stop(),at&&(Object.values(e).forEach((function(e){return e.current.classList.remove("show-bg")})),clearInterval(at),st(null)))}),[Ve]),Object(r.useEffect)((function(){jt&&(vt&&vt.getTracks().forEach((function(e){return e.stop()})),St(!1))}),[jt]),Object(r.useEffect)((function(){n&&_&&(it?T.emit("recording",{fromUsername:n.username,toUsername:_.username,isRecording:!0,fullName:n.fullName}):!1===it&&T.emit("recording",{fromUsername:n.username,toUsername:_.username,isRecording:!1,fullName:n.fullName}))}),[it,n,_]),Object(r.useEffect)((function(){if(it){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){var r,a=tn.current.getContext("2d"),s=[];yt(e);var c=new MediaRecorder(e);Et((function(e){return ne(ne({},e),{},{mediaRecorder:c})})),c.ondataavailable=function(e){s.push(e.data)},c.start(),c.onstop=function(){new Blob(s,{type:"audio/ogg; codecs=opus"}).arrayBuffer().then((function(e){var r={type:"regular",from:t,to:ve,createdAt:(new Date).toISOString()};"reply"===je&&(r.reply=we.id,r.tempReply=we.toMessageId,r.type="reply"),d(r,ve,T,C,e,n).then(ge.bind(null,0)),on.current=!0,ot(!1),Wt(!0),setTimeout((function(){Wt(!1)}),2e3)}))};var i=setInterval((function(){gt((function(e){return e.seconds+1>=60?{minutes:e.minutes+1,seconds:0}:ne(ne({},e),{},{seconds:e.seconds+1})}))}),1e3);mt(i),function(e){r||(r=new AudioContext);var t=r.createMediaStreamSource(e),n=r.createAnalyser();n.fftSize=2048;var s=n.frequencyBinCount,c=new Uint8Array(s);t.connect(n),function e(){var t=tn.current.width,r=tn.current.height;requestAnimationFrame(e),n.getByteTimeDomainData(c),a.fillStyle="#3e3b38",a.fillRect(0,0,t,r),a.lineWidth=2,a.strokeStyle="yellow",a.beginPath();for(var i=1*t/s,o=0,l=0;l<s;l++){var u=c[l]/128*r/2;0===l?a.moveTo(o,u):a.lineTo(o,u),o+=i}a.lineTo(tn.current.width,tn.current.height/2),a.stroke()}()}(e)}),(function(e){ot(!1)}))}else clearInterval(ut),mt(null),gt({minutes:0,seconds:0}),null!=bt&&bt.mediaRecorder&&(bt.mediaRecorder.onstop=function(){}),vt&&vt.getTracks().forEach((function(e){return e.stop()}))}),[it]),Object(r.useEffect)((function(){_&&(_.messages.filter((function(e){return"guest"===e.side&&"seen"!==e.status})).map((function(e){return e._id})).forEach((function(e){if(_.unseen&&(m(e,"seen",ve),T&&w.length)){var t=_.messages.find((function(t){return t._id===e}));T.emit("messageSeenClient",{username:w.find((function(e){return e.userId===_.userId})).username,personId:"host"===t.side?t.from:t.to,messageId:t.toMessageId})}})),cn&&!1===cn.current&&!_.fromSocket&&fn(),on&&!0===on.current&&(fn(),on.current=!1),null!=Xt&&Xt.current&&_.fromSocket&&!sn.current&&fn())}),[_]),Object(r.useEffect)((function(){if(Te){var e=Pe.id,t=Pe.personId,n=Pe.from,r=Pe.toMessageId,a=Pe.isLast;"forMe"===De.type?(y(e,t,a),Ae(!1)):(h(e,t,a,n,r,T),Ae(!1))}}),[Te]);var _n,Cn,In,kn,Mn={},Tn={};function An(){Ue((function(e){return ne(ne({},e),{},{show:!1})}))}function Rn(){Ue((function(e){return ne(ne({},e),{},{show:!1})}))}function Dn(){Ue((function(e){return ne(ne({},e),{},{show:!1})})),Ae(!0)}function Un(e){return("00"+e.toString()).substr(-2)}function Fn(){ot(!0),ze("")}function Pn(){if(null!=Xt&&Xt.current){if(Xt.current.scrollTop<=1){var e=Ct.conversationId,t=Ct.fullName,n=Ct.messengerStatus,r=Ct.username;l(e,t,n,!1,void 0,r),Jt(!0)}Xt.current.scrollTop+Xt.current.offsetHeight<Xt.current.scrollHeight-100?null!=an&&an.current&&(an.current.classList.add("active"),sn.current=!0):null!=an&&an.current&&(an.current.classList.remove("active"),$t(0),sn.current=!1),Xt.current.scrollTop+Xt.current.offsetHeight>=Xt.current.scrollHeight&&(cn.current=!0)}}function xn(){rn&&rn.current&&window.innerWidth<=1300&&(rn.current.style.display="block"),nn&&nn.current&&window.innerWidth<=1300&&(nn.current.style.display="none"),O(),ge(-1)}function Ln(){null!=Xt&&Xt.current&&(Xt.current.scrollTo(0,Xt.current.scrollHeight),setTimeout((function(){$t(0),sn.current=!1}),1e3))}function Bn(){U(!1)}function Hn(){null!=bt&&bt.mediaRecorder&&(bt.mediaRecorder.stop(),He(!1),Se("regular"),_e({}),ke({}),Ze(!1))}return null!=Ie&&Ie.message&&Ie.message.charCodeAt(0)>=1570&&Ie.message.charCodeAt(0)<=1740&&(Mn.direction="rtl",Mn.fontFamily="Tahoma",Mn.fontSize="1.3rem",Tn.direction="rtl"),a.a.createElement("div",{className:"messenger--container"},!w&&a.a.createElement(P.a,null),a.a.createElement("div",{ref:nn,onClick:function(e){var t=e.target;t.className||(t=t.parentElement),t.className.includes("messenger--message__tools-icon-container")||me(-1)},className:"messenger--main-container"},!_&&zt&&a.a.createElement("div",{className:"spinner--container"},a.a.createElement(M.a,null)),_&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"messenger--main__header-container"},a.a.createElement("div",{onClick:xn,className:"messenger--main__header--back-container"},a.a.createElement("img",{src:ee.a,alt:"back"})),a.a.createElement("div",{className:"messenger--main__header"},a.a.createElement("div",{className:"messenger--main__header--text-group"},a.a.createElement(o.a,{target:"_blank",to:"/profile/".concat(_.username),className:"full-name"},_.fullName),(In=Rt.length&&Rt.find((function(e){return e.username===_.username})),kn=Ft.length&&Ft.find((function(e){return e.username===_.username})),In&&In.isTyping?a.a.createElement("p",{className:"typing"},Object(x.a)(In.fullName.split(" ")[0],10)," is typing..."):kn&&kn.isRecording?a.a.createElement("p",{className:"typing"},Object(x.a)(kn.fullName.split(" ")[0],10)," is recording Audio..."):"online"===_.messengerStatus.text?a.a.createElement("p",{className:"online"},"online"):"offline"===_.messengerStatus.text?a.a.createElement("p",{className:"offline"},"last seen ",Object(B.a)(_.messengerStatus.date)):void 0)))),a.a.createElement("div",{ref:Xt,onScroll:Pn,onClick:Bn,className:"messenger--main__body-container",style:De.show||Ve?{overflowY:"hidden"}:{}},zt&&a.a.createElement("div",{className:"spinner--container",style:{top:(null===(_n=Xt.current)||void 0===_n?void 0:_n.scrollHeight)-(null===(Cn=Xt.current)||void 0===Cn?void 0:Cn.offsetHeight)+"px"}},a.a.createElement(M.a,null)),_&&On(),a.a.createElement("div",{className:"messenger--main__body--pop-up-container"+(De.show?" show":""),style:{top:De.popUpTop+"px"}},a.a.createElement("p",null,"Are you sure you want to delete this message for ","forMe"===De.type?"yourself":"everyone","?"),a.a.createElement("div",{className:"button--container"},a.a.createElement("button",{className:"yes",onClick:Dn},"Yes"),a.a.createElement("button",{className:"cancel",onClick:Rn},"Cancel"))),a.a.createElement("div",{className:"messenger--main__body--circles-container"+(Ve?" show":""),style:null!=Xt&&Xt.current?{top:Xt.current.scrollTop+"px"}:{}},a.a.createElement("div",{className:"circles--one",ref:Gt}),a.a.createElement("div",{className:"circles--two",ref:Qt}),a.a.createElement("div",{className:"circles--three",ref:Vt}),a.a.createElement("div",{className:"circles--four",ref:Zt},a.a.createElement("p",null,"Listening"),a.a.createElement("p",null,"Speak Now")),a.a.createElement("div",{className:"circles--five",onClick:Ze.bind(null,!1),ref:en},a.a.createElement("img",{src:V,alt:"Stop Button"}))),De.show&&a.a.createElement("div",{onClick:An,className:"bg",style:{top:De.mainBgTop+"px"}}),Ve&&a.a.createElement("div",{onClick:An,className:"bg",style:{top:(null==Xt?void 0:Xt.current.scrollTop)+"px"}})),a.a.createElement("div",{onClick:Ln,ref:an,className:"on--scroll-container"},Kt>0&&a.a.createElement("div",{className:"new--message"},Kt),a.a.createElement("div",{className:"go--bottom"},a.a.createElement("img",{src:ee.a,alt:"down"}),a.a.createElement("img",{src:ee.a,alt:"down"}))),a.a.createElement("div",{className:"messenger--main__bottom-container"},Object.keys(we).length?function(){if(we.isBuf)return a.a.createElement("div",{className:"messenger--main__reply-container"},a.a.createElement("div",{className:"reply--title"},"Reply to"),a.a.createElement("div",{className:"reply--container",onClick:Nn},a.a.createElement("div",{className:"reply--header"},"host"===we.side?"You":be),a.a.createElement("div",{className:"reply--message"},a.a.createElement("div",{className:"messenger--item__voice-container"},a.a.createElement("img",{src:K,alt:"microphone"}),a.a.createElement("p",{className:"messenger--item__message"},"voice message")))),a.a.createElement("div",{className:"icon",onClick:jn},a.a.createElement("img",{src:G.a,alt:"close"})));var e={},t={};return null!=we&&we.message&&we.message.charCodeAt(0)>=1570&&we.message.charCodeAt(0)<=1740&&(e.direction="rtl",e.fontFamily="Tahoma",e.fontSize="1.3rem",t.direction="rtl"),a.a.createElement("div",{className:"messenger--main__reply-container"},a.a.createElement("div",{className:"reply--title"},"Reply to"),a.a.createElement("div",{className:"reply--container",onClick:Nn},a.a.createElement("div",{className:"reply--header",style:t},"host"===we.side?"You":be),a.a.createElement("div",{className:"reply--message",style:e},!!we&&!!we.message&&Object(x.a)(null==we?void 0:we.message,50))),a.a.createElement("div",{className:"icon",onClick:jn},a.a.createElement("img",{src:G.a,alt:"close"})))}():void 0,Object.keys(Ie).length?a.a.createElement("div",{className:"messenger--main__edit-container"},a.a.createElement("div",{className:"reply--title edit--title"},"Editing"),a.a.createElement("div",{className:"reply--container",onClick:wn},a.a.createElement("div",{className:"reply--header",style:Tn},"host"===Ie.side?"You":be),a.a.createElement("div",{className:"reply--message",style:Mn},!!Ie&&!!Ie.message&&Object(x.a)(null==Ie?void 0:Ie.message,50))),a.a.createElement("div",{className:"icon",onClick:Sn},a.a.createElement("img",{src:G.a,alt:"close"}))):void 0,!it&&a.a.createElement("div",{className:"messenger--main__input-container"},D&&a.a.createElement("div",{className:"messenger--main__emoji-container"},a.a.createElement(c.a,{onEmojiClick:ln})),a.a.createElement("div",{onClick:un,className:"messenger--main__emoji-btn"},a.a.createElement("img",{src:q,alt:"emoji",className:D?"emoji--selected":void 0})),a.a.createElement(k,{shouldMessageSent:Be,messageInputChange:Ye,onMessengerInputEl:Ke,onHandleMessageSent:mn,onShowMic:Ge,messengerSocket:T,fromUsername:n.username,toUsername:_.username,fullName:n.fullName,shouldClear:Lt}),Xe?a.a.createElement("div",{className:"messenger--main__mic-container",onClick:Fn},a.a.createElement("img",{src:K,alt:"Microphone"})):a.a.createElement("button",{onClick:He.bind(null,!0)},a.a.createElement("img",{src:z,alt:"send"})),Ve?a.a.createElement("div",{onClick:Ze.bind(null,!1),className:"messenger--main__stop-container"},a.a.createElement("img",{src:V,alt:"Stop Button"})):a.a.createElement("div",{className:"messenger--main__speech-container",onClick:function(){return Ze(!0)}},a.a.createElement("img",{src:K,alt:"Microphone"}),a.a.createElement("div",null,a.a.createElement("img",{src:$,alt:"right arrow"}),a.a.createElement("img",{src:$,alt:"right arrow"})),a.a.createElement("img",{src:X,alt:"text"}))),it&&a.a.createElement("div",{className:"messenger--main__voice-container"},a.a.createElement("div",{className:"analyser--container"},a.a.createElement("canvas",{ref:tn})),a.a.createElement("div",{className:"voice--right"},a.a.createElement("div",{className:"decline--icon-container icon--container",onClick:ot.bind(null,!1)},a.a.createElement("img",{src:Z.a,alt:"cross"})),a.a.createElement("div",{className:"timer"},a.a.createElement("div",{className:"sign"}),Un(ft.minutes),":",Un(ft.seconds)),a.a.createElement("div",{className:"accept--icon-container icon--container",onClick:Hn},a.a.createElement("img",{src:J.a,alt:"check"}))))))),a.a.createElement("div",{ref:rn,className:"messenger--side-container"},a.a.createElement("div",{className:"messenger--side__body-container"},a.a.createElement("ul",{className:"messenger--side__items"},Y&&(w.sort((function(e,t){return new Date(t.messages[0].createdAt)-new Date(e.messages[0].createdAt)})),w.map((function(e,t){return a.a.createElement("li",{key:e._id,onClick:dn.bind(null,e._id,e.userId,e.fullName,e.messengerStatus,t,e.username,e.unseen),className:"messenger--side__item"+(fe===t?" selected":"")},a.a.createElement("div",{className:"messenger--item__left-container"},a.a.createElement("div",{className:"online"===e.messengerStatus.text?"messenger--status__online":"messenger--status__offline"},a.a.createElement("img",{src:e.avatar,alt:e.fullName})),a.a.createElement("div",{className:"messenger--item__left-name"},a.a.createElement("p",{className:"messenger--item__name"},e.fullName),function(e){var t,n,r=Rt.length&&Rt.find((function(t){return t.username===e.username})),s=Ft.length&&Ft.find((function(t){return t.username===e.username}));return r&&r.isTyping?a.a.createElement("p",{className:"typing"},Object(x.a)(r.fullName.split(" ")[0],10)," is typing..."):s&&s.isRecording?a.a.createElement("p",{className:"typing"},Object(x.a)(s.fullName.split(" ")[0],10)," is recording Audio..."):"deleteForMe"===e.messages[0].type||"deleteForEveryone"===e.messages[0].type?a.a.createElement("em",null,"message was deleted!"):e.messages[0].isBuf?e.messages[0].isBuf?a.a.createElement("div",{className:"messenger--item__voice-container"},a.a.createElement("img",{src:K,alt:"microphone"}),a.a.createElement("p",{className:"messenger--item__message"},"voice message")):void 0:a.a.createElement("p",{style:function(e){var t={};return e[0].charCodeAt(0)>=1570&&e[0].charCodeAt(0)<=1740&&(t.direction="rtl",t.fontFamily="Tahoma",t.fontSize="1.3rem"),t}(null===(t=e.messages[0])||void 0===t?void 0:t.message),className:"messenger--item__message"},Object(x.a)(null===(n=e.messages[0])||void 0===n?void 0:n.message))}(e))),a.a.createElement("div",{className:"messenger--item__right-container"},function(e,t){var n=Rt.length&&Rt.find((function(t){return t.username===e.username})),r=Ft.length&&Ft.find((function(t){return t.username===e.username}));return n&&n.isTyping||r&&r.isRecording?a.a.createElement("p",{className:"messenger--item__time"},"now"):a.a.createElement(a.a.Fragment,null,a.a.createElement("p",{className:"messenger--item__time"},Object(B.a)(e.messages[0].createdAt)),fe!==t&&0!==e.unseen&&a.a.createElement("p",{className:"messenger--item__unseen"},e.unseen))}(e,t)))})))))))};t.default=Object(L.a)(Object(i.b)((function(e){return{userId:e.messenger.userId,conversations:e.messenger.conversations,conversationData:e.messenger.conversationData,userInfo:e.messenger.userInfo,mainSocket:e.sockets.main,statusSocket:e.sockets.status,identifier:e.identifier}}),{fetchMessages:function(){return O((function(e,t){return N(S((function(){return E(fetch("/api/messenger"),(function(n){return E(n.json(),(function(n){Object.keys(t().tempMessage).length&&e({type:m.c,payload:{messengerData:n,conversationData:h(h({},t().tempMessage),{},{isFromProfile:!0})}}),e({type:m.c,payload:{messengerData:n,conversationData:!1}})}))}))}),j))}))},fetchIndividualConversation:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;return function(c,i){return E(S((function(){var o,l=O((function(){return E(fetch("/api/messenger/".concat(e,"/").concat(10*o)),(function(e){return E(e.json(),(function(e){var t=!1,n=e.messages.filter((function(e){return e.reply})).map((function(e){return e.reply})),r=!1;return n.forEach((function(t){e.messages.find((function(e){return e._id===t}))||(r=!0)})),p((function(){if(r)return o+=1,t=!0,g(l)}),(function(n){return t?n:e}))}))}))}));return a?c({type:m.d,payload:void 0}):(r||(o=i().messenger.conversationData.messageBucket),o=o?o+1:1,g(l,(function(e){e.fullName=t,e.messengerStatus=n,e.messageBucket=o,e.username=s,c({type:m.d,payload:e})})))}),j))}},updateMessageStatus:function(e,t,n){return O((function(r){return N(S((function(){var a={messageId:e,status:t};return E(fetch("/api/messenger",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),(function(){r({type:m.g,payload:{messageId:e,status:t,conversationPersonId:n}})}))}),j))}))},submitNewMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;return O((function(s,c){return N(S((function(){var i=h({},e),o=(64*Math.random()).toString();return i._id=o,i.toMessageId=(64*Math.random()).toString(),i.createdAt=Date.now(),i.side="host",i.status="pending",r&&(i.isBuf=!0),s({type:m.f,payload:{message:i,personId:t,shouldUpdateConversationData:!0}}),p((function(){if(r)return E(fetch("/api/messenger/".concat(t),{method:"POST",body:r}),(function(t){return E(t.json(),(function(t){var n=t.data,r=n.senderMessage,a=n.receiverMessage;e.isBuf=!0,e.message=r,e.messageBuf={senderMessage:r,receiverMessage:a}}))}))}),(function(){return E(fetch("/api/messenger/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),(function(r){return E(r.json(),(function(r){var i=r.data,l=i.messageId,u=i.toMessageId,f=i.createdAt;e._id=l,e.toMessageId=u,e.createdAt=f,e.side="host",e.status="sent",s({type:m.f,payload:{message:e,personId:t,shouldUpdateConversationData:!0,tempMessageId:o}});var g=c().messenger.conversations.find((function(t){return t.userId===e.to}));!g&&Object.keys(c().tempMessage).length&&(g=c().tempMessage,s({type:d.b}));var p=h({},e);e&&e.reply&&e.tempReply&&(p.reply=p.tempReply,delete p.tempReply),n.emit("messageSent",{fromUsername:a.username,toUsername:g.username,fullName:g.fullName,userInfo:a,message:p}),c().sockets.status.emit("new-message",{toUsername:g.username})}))}))}))}),j))}))},fetchMessengerSocket:w.b,submitNewMessageFromSocket:function(e,t,n,r){return O((function(a,s){return N(S((function(){var c=h(h({},e),{},{_id:e.toMessageId,toMessageId:e._id});return a({type:m.f,payload:{message:c,personId:t,shouldUpdateConversationData:n,userInfo:r,fromSocket:!0}}),function(e){var t=e();if(t&&t.then)return t.then(j)}((function(){if(n)return v(fetch("/api/messenger/unseen",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({encryptedPersonId:t})}));var e=s().messenger.conversations.find((function(e){return e.userId===t}));e&&1===e.unseen&&a({type:f.e})}))}),j))}))},updateMessageTextFromSocket:function(e,t,n,r,a,s){return O((function(c){try{var i={newMessage:e,messageId:n,type:a,isLast:r,personId:t,shouldUpdateConversationData:s};c({type:m.h,payload:i})}catch(e){}return E()}))},deleteMessageForMe:function(e,t,n){return O((function(r){var a={messageId:e,type:"deleteForMe",oneWay:!0,personId:t};return a.isLast=n,r({type:m.b,payload:a}),v(fetch("/api/messenger",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}))}))},deleteMessageForEveryone:function(e,t,n,r,a,s){return O((function(c,i){var o={messageId:e,type:"deleteForEveryone",oneWay:!1,personId:t,shouldUpdateConversationData:!0};return o.isLast=n,c({type:m.a,payload:o}),E(fetch("/api/messenger",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),(function(){var e=i().messenger.conversations.find((function(e){return e.userId===t}));s.emit("messageDeleted",{toUsername:e.username,fullName:e.fullName,isLast:n,message:{from:r,toMessageId:a}})}))}))},deleteMessageFromSocket:function(e,t,n,r){return O((function(a){var s={messageId:t,type:"deleteForEveryone",personId:e,shouldUpdateConversationData:r};return s.isLast=n,a({type:m.a,payload:s}),E()}))},messengerStart:function(){return O((function(){return N(S((function(){return v(fetch("/api/messenger/start"))}),j))}))},updateMessageText:function(e,t,n,r,a,s,c,i){return O((function(o,l){return N(S((function(){var u={newMessage:e,messageId:n,type:a,isLast:r,personId:t,shouldUpdateConversationData:!0};return o({type:m.h,payload:u}),E(fetch("/api/messenger",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),(function(){var e=l().messenger.conversations.find((function(e){return e.userId===t})),n=h(h({},c),{},{type:a,toMessageId:i});s.emit("messageUpdatedSent",{toUsername:e.username,fullName:e.fullName,message:n,isLast:r})}))}),j))}))},wipeTempMessage:function(){return O((function(e,t){return t().messenger.conversationData&&e({type:d.b}),E()}))},messengerUpdateUserStatus:function(e,t){return O((function(n){return n({type:m.e,payload:{username:e,status:t}}),E()}))},receiveNotificationMessenger:Y.e,wipeIndividualConversation:function(){return O((function(e){return e({type:m.i}),E()}))}})(a.a.memo(oe)))}}]);